# 更新日志

本文档记录了 Claude Switcher 的所有重要更改。

## [未发布]

### 🎨 用户界面优化
- **全新菜单设计** - 采用方案B分组设计，使用emoji图标分组功能
  - 🚀 快速启动区：一键直接启动配置，无需额外确认
  - ⚙️ 配置管理区：创建、编辑、删除功能集中管理
  - 📋 其他功能区：配置详情、退出等辅助功能
- **扁平化交互** - 从3层菜单简化为1层主菜单，减少点击次数
- **统一流程** - 所有操作完成后自动返回主菜单，避免用户迷路
- **智能默认** - 主菜单默认选择上次使用的配置，快速启动

### ✨ 新增功能
- **支持任意环境变量配置** - 程序现在可以读取配置文件中的所有环境变量并导出到运行环境 (Fixes #6)
  - 支持 `ANTHROPIC_MODEL` 和 `ANTHROPIC_SMALL_FAST_MODEL` 等变量
  - 用户可以直接编辑配置文件添加任意环境变量
  - 程序退出时自动恢复原始环境变量

### 🐛 修复
- 修复菜单标题重复显示的问题
- **修复cp命令目标路径问题** - 在重命名和复制配置时确保目标目录存在，避免在某些机器上报错 (Fixes #5)
- **修复Claude Code下载地址** - 更正错误的claude-cli地址为正确的claude-code地址 (Fixes #4)
- 增强编辑配置时的文件存在性检查

---

## [v1.1.0] - 2025-01-27

> **重大更新**: 这是一个包含重要安全修复和功能增强的版本。强烈建议所有用户升级。
> 
> **主要亮点**: 
> - 🛡️ 修复路径遍历安全漏洞
> - ✨ 新增配置验证、重命名、复制功能  
> - 🔧 大幅改进错误处理和用户体验
> - 📱 完整的命令行参数支持

### 🛡️ 安全性修复
- **配置名称安全验证**
  - 防止路径遍历攻击（拒绝包含 `../`、`~`、`$` 等危险字符）
  - 限制配置名称长度和格式，提升系统安全性
  - 拒绝以点开头/结尾或包含空格的配置名称
- **输入安全验证**
  - 新增URL格式验证，确保Base URL格式正确
  - 新增代理地址格式验证，防止格式错误导致的问题
  - 所有用户输入都经过严格验证
- **环境变量安全处理**
  - 改进环境变量恢复机制，正确处理未设置的原始变量
  - 程序异常退出时自动恢复原始环境变量
  - 防止环境变量污染影响其他进程

### ✨ 新增功能
- **配置验证系统**
  - 新增 `--test <配置名称>` 参数测试配置有效性
  - 自动检查Base URL、代理地址格式
  - 智能提示缺失的必要配置项
- **配置管理增强**
  - 新增 `--rename <旧名称> <新名称>` 参数重命名配置
  - 新增 `--copy <源名称> <目标名称>` 参数复制配置
  - 重命名时自动更新活动配置记录
  - 复制时自动更新配置文件中的NAME字段
- **命令行参数支持** (#3)
  - 支持 `claude-switcher <配置名称>` 直接启动指定配置
  - 支持 `claude-switcher --config <配置名称>` 启动指定配置
  - 新增 `--list` 参数列出所有可用配置
  - 新增 `--help` 参数显示帮助信息

### 🔧 优化改进
- **错误处理优化**
  - 创建配置时不再因错误直接退出程序，改为返回交互界面
  - 所有输入验证失败时提供重试选项
  - 统一错误处理策略，提升用户体验
- **用户交互体验**
  - 配置创建流程增加输入验证和重试机制
  - 输入错误时提供友好的错误提示和操作指导
  - 保持向后兼容，无参数时仍为完整交互式体验
- **代码质量提升**
  - 遵循SOLID原则，功能模块化设计
  - 新增专用安全验证函数，职责清晰
  - 改进函数命名和代码结构，提升可维护性
- **智能IP检查** (#2)
  - 当设置自定义 `ANTHROPIC_BASE_URL` 时自动跳过出口IP检查
  - 提升使用代理或镜像服务的启动速度
  - 保持默认API地址的网络连通性检查

### 🐛 修复
- 修复配置名称可能导致的路径遍历安全漏洞
- 修复环境变量恢复逻辑中的潜在问题
- 修复创建配置时的错误退出行为
- 修复通过管道安装时无法获取用户输入的问题
- 修复IP检测失败时缺少用户提示的问题

### 📚 文档
- 大幅更新README文档，新增配置管理功能说明
- 新增安全增强特性的详细说明和示例
- 完善命令行参数使用说明和错误处理示例
- 更新功能特性列表，突出安全性和配置管理能力
- 新增配置验证、重命名、复制功能的使用示例

### 🧪 测试
- 验证所有新增功能正常工作
- 测试安全验证机制有效阻止攻击
- 确保向后兼容性完整保持
- 验证错误处理的友好性和准确性

### 其他
- 允许创建空Token配置，提升配置管理灵活性
- 代码遵循Clean Code最佳实践
- 支持在自动化脚本中安全使用

---

## [v1.0.0] - 2025-01-24

### 初始版本功能
- **基础配置管理**
  - 创建、编辑、删除Claude配置
  - 多配置快速切换
  - 配置文件安全存储（权限600）
- **交互式体验**
  - 友好的中文界面
  - 智能默认选项
  - 上次使用配置记忆
- **网络检测**
  - 启动前IP地址检查
  - 美国IP检测和提示
- **基础安全**
  - 配置文件权限保护
  - Token显示时自动掩码
- **安装支持**
  - 一键安装脚本
  - 系统路径集成

---

## 格式说明

版本格式遵循 [语义化版本](https://semver.org/lang/zh-CN/)

### 更改类型
- `新增功能` - 新增的功能
- `优化改进` - 对现有功能的改进
- `修复` - 错误修复
- `文档` - 仅文档更改
- `其他` - 其他类型的更改

### 参考链接
- `#数字` - 关联的 GitHub Issue 编号